{% extends "CVPlatformBundle::layout.html.twig" %}

{% block title %}
    Lecture d'une annonce - {{ parent() }}
{% endblock %}

{% block cvplatform_body %}
    {% stylesheets 
        '@CVPlatformBundle/Resources/public/css/dialog.css'
        '@CVPlatformBundle/Resources/public/css/button.css' %}
        <link rel="stylesheet" href="http://lipis.github.io/bootstrap-sweetalert/lib/sweet-alert.css">
        <link rel="stylesheet" href="{{ asset_url }}" type="text/css" />
    {% endstylesheets %}



    <div class="well">
        <p>{% include 'CVPlatformBundle:Ride:focus_details.html.twig' with {'ride': ride} %}</p></br>
        <p>
            <a href="{{ path('cv_platform_home') }}" class="btn btn-primary btn-outline btn-lg"><i class="glyphicon glyphicon-chevron-left"></i>Retour à la liste</a>


            {% if app.security.getToken().getUser() != ride.user %}
            {% if isFull %}
            <button class="btn btn-lg btn-success"><i class="glyphicon glyphicon-ok-circle"></i> Complet</button>                 
            {% else %}
            {% if existPassenger %}
            Vous avez déjà réservé une ou plusieurs places pour cette annonce
            {% else %}   

            {% if ride.getNumberPassenger() - numberOfPlacesBooked != 0 %}

            <button class="btn btn-lg btn-warning sweet-13" onclick="_gaq.push(['_trackEvent', 'example, 'try', 'Warning']);"><i class="glyphicon glyphicon-hand-up"></i> Réserver</button>

            <p> Sélectionnez le nombre de places à réserver</p>
            <FORM>
                <SELECT name="numberOfPlacesBooked" id="numberOfPlacesBooked" size="1">

                    {% for i in 1..ride.getNumberPassenger() - numberOfPlacesBooked %}
                    <OPTION value = '{{i}}'>{{i}}</OPTION>
                    {% endfor %}
                </SELECT>
            </FORM>
        </p>

        {% endif %}
        {% endif %}
        {% endif %}
        {% endif %}

          
    </div>
    <div class="well">
<!--         <ol id="messages" class="messages">
            {% for publicMessage in listPublicMessagesOfRide %}
                {% include 'CVPlatformBundle:PublicMessage:view.html.twig' with {'publicMessage': publicMessage} %}
            {% endfor %}
        </ol> -->
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h2 class="page-header">Questions posées</h2>
                    <section id="messages" class="messages comment-list">
                        {% for publicMessage in listPublicMessagesOfRide %}
                            {% include 'CVPlatformBundle:PublicMessage:view.html.twig' %}
                        {% endfor %}
                    </section>
                </div>
            </div>
        </div>
  
        <div class="well">
            <textarea id="contentT" rows="5" cols="111" placeholder="Posez vos questions ou réponses ici."></textarea><br/>
            <div align="right"><button id="publish" class="btn btn-primary" type="button" >Publier</button></div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="http://lipis.github.io/bootstrap-sweetalert/lib/sweet-alert.js"></script>
    <script type="text/javascript"> // Commentaires
        $("#publish").on("click", addPublicMessage);
        function addPublicMessage(){
            var content = 'content='+document.getElementById('contentT').value;
            $.ajax({
                url: "{{ path('cv_platform_add_public_message', {'ride': ride.id}) }}",
                data: content,
                success: addingPublicMessage
            }); 
        }
        function addingPublicMessage(data) {
            $("#messages").append(data);
            document.getElementById('contentT').value="";
        }
    </script>
    <script> // Boite de confirmation

    //alert(document.getElementById("numberOfPlacesBooked").value);

        document.querySelector('.sweet-13').onclick = function(){
            swal({
                title: "Êtes vous sure de vouloir réserver cette annonce ?",
                text: "Vous serez débité 2 jours après le voyage",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-warning",
                confirmButtonText: "Oui",
                cancelButtonText: "Non",
                closeOnConfirm: false,
                closeOnCancel: false
            },
            function(isConfirm) {
                if (isConfirm) {
                    swal({
                        title: "Votre réservation a bien été enregistrée",
                        text: "Veuillez donner le code que nous vous avons envoyé au conducteur à la fin de votre voyage",
                        type: "success",
                        confirmButtonClass: "btn-success",
                        confirmButtonText: "Ok",
                        closeOnConfirm: true,
                    },
                    function() {
                 var valeur = 'valeur='+document.getElementById("numberOfPlacesBooked").value;

                        $.ajax({
                            url: "{{ path('cv_platform_confirm_reservation_ride', {'id': ride.id }) }}",
                            data: valeur,
                            success: function(data) {
                                window.location.replace("{{ path('cv_platform_my_reservations') }}");
                            }
                        }); 
                    });
                } else {
                    swal({
                        title: "Annulation",
                        text: "Vous ne serez pas débité",
                        type: "error",
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "Ok",
                        closeOnConfirm: true,
                    });
                }
            });
        };
    </script>
{% endblock %}